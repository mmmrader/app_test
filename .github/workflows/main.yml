name: Check Telegram Schedule

on:
  schedule:
    - cron: '*/15 * * * *'
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    # --- üëá –î–û–î–ê–ô–¢–ï –¶–Ü –î–í–ê –†–Ø–î–ö–ò üëá ---
    permissions:
      contents: write
    # ------------------------------------

    steps:
      # 1. –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –∫–æ–¥ (—Ü–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± checkout v4 –º–∞–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø—Ä–∞–≤–∞)
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      # 3. –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. –ó–ê–ü–£–°–ö–ê–Ñ–ú–û –ù–ê–® –°–ö–†–ò–ü–¢
      - name: Run Python script
        env:
          API_ID: ${{ secrets.API_ID }}
          API_HASH: ${{ secrets.API_HASH }}
          TELETHON_SESSION: ${{ secrets.TELETHON_SESSION }}
          CHANNEL_USERNAME: 'SvitloOleksandriyskohoRaionu'
        run: python check_updates.py

      # 5. –ö–û–ú–Ü–¢–ò–ú–û –ó–ú–Ü–ù–ò
      - name: Commit and push if files changed
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: '–ê–≤—Ç–æ-–æ–Ω–æ–≤–ª–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫—ñ–≤'
          # –ú–∏ –±—ñ–ª—å—à–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ file_pattern, —â–æ–± –∫–æ–º—ñ—Ç–∏—Ç–∏ –í–°–Ü —Ñ–∞–π–ª–∏